(()=>{"use strict";var t=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function l(t){try{u(n.next(t))}catch(t){r(t)}}function o(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(l,o)}u((n=n.apply(t,e||[])).next())}))};function e(t,e,i,n=null,s=0,r=!0){let l=function(t,e){const i=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(i," attribute vec4 aVertexPosition;\n\nvoid main() {\n  gl_Position = aVertexPosition;\n}"),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}(t),o=function(t,e){const i=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(i,"precision mediump float;\nuniform vec4 vColor;\nuniform int point;\n\nvoid main() {\n\n  gl_FragColor = vColor;\n}\n\n"),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}(t),u=function(t,e,i){let n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;console.log(t.getProgramInfoLog(n)),t.deleteProgram(n)}(t,l,o),h=t.getAttribLocation(u,"aVertexPosition"),a=t.getUniformLocation(u,"vColor"),p=t.getUniformLocation(u,"point"),c=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,c),i=function(t,e,i){let n=[];for(let e=0;e<t.length;e+=2){let s=2*Math.PI/12;for(let r=0;r<=2*Math.PI;r+=s)n=n.concat([t[e],t[e+1],Math.sin(r)*i+t[e],Math.cos(r)*i+t[e+1],Math.sin(r+s)*i+t[e],Math.cos(r+s)*i+t[e+1]])}return n}(i,0,.02);let f=e.concat(i),d=[],g=[];if(null!=n){let t=64;s>64&&(t=s*Math.PI/8);let e=2*Math.PI/t;for(let t=0;t<=2*Math.PI;t+=e){let i=Math.sin(t)*s+n.x,r=Math.cos(t)*s+n.y,l=Math.sin(t+e)*s+n.x,o=Math.cos(t+e)*s+n.y;d.push(i,r,l,o),g.push(n.x,n.y,i,r,l,o)}f=f.concat(d),f=f.concat(g)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(f),t.STATIC_DRAW),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(.094,.094,.145,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(u),t.enableVertexAttribArray(h),t.bindBuffer(t.ARRAY_BUFFER,c);let m=t.FLOAT,y=0;if(t.vertexAttribPointer(h,2,m,!1,0,y),null!=n){r?t.uniform4f(a,.651,.89,.631,.33):t.uniform4f(a,.98,.702,.529,.33),t.uniform1i(p,1);let n=t.TRIANGLES;y=e.length/2+i.length/2+d.length/2;let s=g.length/2;console.log(s),t.drawArrays(n,y,s),r?t.uniform4f(a,.651,.89,.631,1):t.uniform4f(a,.98,.702,.529,1),t.uniform1i(p,1),n=t.LINES,y=e.length/2+i.length/2,s=d.length/2,console.log(s),t.drawArrays(n,y,s)}t.uniform4f(a,.537,.706,.98,1),t.uniform1i(p,1);let q=t.LINES;y=0;let v=e.length/2;console.log(v),t.drawArrays(q,y,v),t.uniform4f(a,.953,.545,.659,1),t.uniform1i(p,1),q=t.TRIANGLES,y=e.length/2,v=i.length/2,t.drawArrays(q,y,v)}class i{constructor(t,e,i){this.x=t,this.y=e,this.z=i}cmult(t){return new i(this.x*t,this.y*t,this.z*t)}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return this.add(t.cmult(-1))}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}mag(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}cross(t){return new i(this.y*t.z-this.z*t.y,this.x*t.z-this.z*t.x,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}pair(){return[this.x,this.y]}}class n{constructor(t,e,i){this.p1=t,this.p2=e,this.p3=i}equals(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)&&this.p3.equals(t.p3)||this.p1.equals(t.p1)&&this.p2.equals(t.p3)&&this.p3.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)&&this.p3.equals(t.p3)||this.p1.equals(t.p2)&&this.p2.equals(t.p3)&&this.p3.equals(t.p1)||this.p1.equals(t.p3)&&this.p2.equals(t.p1)&&this.p3.equals(t.p2)||this.p1.equals(t.p3)&&this.p2.equals(t.p2)&&this.p3.equals(t.p1)}hasCommmonVertex(t){return this.p1.equals(t.p1)||this.p2.equals(t.p1)||this.p3.equals(t.p1)||this.p1.equals(t.p2)||this.p2.equals(t.p2)||this.p3.equals(t.p2)||this.p1.equals(t.p3)||this.p2.equals(t.p3)||this.p3.equals(t.p3)}getEdges(){return[[this.p1,this.p2],[this.p2,this.p3],[this.p3,this.p1]]}getCircumradius(){return this.p1.sub(this.p2).mag()*this.p2.sub(this.p3).mag()*this.p3.sub(this.p1).mag()/(2*this.p1.sub(this.p2).cross(this.p2.sub(this.p3)).mag())}getCircumcenter(){let t=2*Math.pow(this.p1.sub(this.p2).cross(this.p2.sub(this.p3)).mag(),2),e=Math.pow(this.p2.sub(this.p3).mag(),2)*this.p1.sub(this.p3).dot(this.p1.sub(this.p2))/t,i=Math.pow(this.p1.sub(this.p3).mag(),2)*this.p2.sub(this.p3).dot(this.p2.sub(this.p1))/t,n=Math.pow(this.p1.sub(this.p2).mag(),2)*this.p3.sub(this.p1).dot(this.p3.sub(this.p2))/t;return this.p1.cmult(e).add(this.p2.cmult(i)).add(this.p3.cmult(n))}inCircumscribe(t){return this.getCircumcenter().sub(t).mag()<this.getCircumradius()}hasEdge(t,e){return(this.p1.equals(t)||this.p2.equals(t)||this.p3.equals(t))&&(this.p1.equals(e)||this.p2.equals(e)||this.p3.equals(e))&&!t.equals(e)}}function s(t,e){for(let i=0;i<t.length;i++)if(t[i].equals(e))return i;return-1}function r(t){let e=[];for(let i of t)for(let t of i.getEdges())e.push(t[0].x,t[0].y,t[1].x,t[1].y);return e}function l(e,i){return t(this,void 0,void 0,(function*(){let n=document.getElementById(e);n.style.outline="solid",n.style.outlineWidth="4px",n.style.outlineColor="#96CDFB",yield function(e){return t(this,void 0,void 0,(function*(){let t;e.addEventListener("click",(function(){t(0)})),document.addEventListener("cancelStep",(function(){t(0)}));let i=new Promise((e=>{t=e}));yield i}))}(i),n.style.outline="2px solid transparent",n.style.outlineOffset="2px"}))}function o(o,u,h=!1,a=new HTMLElement){return t(this,void 0,void 0,(function*(){document.addEventListener("cancelStep",(function(){h=!1}));let t=[],p=[];if(h&&(e(o,[],u),yield l("line02",a),!h))return[];if(u.length<2)return p;let c=u[0],f=c,d=u[1],g=d;for(let e=0;e<u.length;e+=2)u[e]<c&&(c=u[e]),u[e]>f&&(f=u[e]),u[e+1]<d&&(d=u[e+1]),u[e+1]>g&&(g=u[e+1]),t.push(new i(u[e],u[e+1],0));let m=new i(c-1e6,d-1e6,0),y=new i(f+1e6,d-1e6,0),q=new i(Math.floor((c+f)/2),g+1e6,0),v=new n(m,y,q);if(p.push(v),h&&(e(o,r(p),u),yield l("line03",a),!h))return[];let E=[];for(let i of t){if(E.push(i.x,i.y),h&&(e(o,r(p),E),yield l("line04",a),!h))return[];let t=[];if(h&&(e(o,r(p),E),yield l("line05",a),!h))return[];for(let n of p){if(h&&(e(o,r(p),E),yield l("line06",a),!h))return[];let s=n.inCircumscribe(i);if(h&&(e(o,r(p),E,n.getCircumcenter(),n.getCircumradius(),!s),yield l("line07",a),!h))return[];if(s&&(t.push(n),h&&(e(o,r(p),E),yield l("line08",a),!h)))return[]}let u=[];if(h&&(e(o,r(p),E),yield l("line09",a),!h))return[];for(let i of t){if(h&&(e(o,r(p),E),yield l("line10",a),!h))return[];for(let n of i.getEdges()){if(h&&(e(o,r(p),E),yield l("line11",a),!h))return[];let s=!1;for(let e of t)!i.equals(e)&&e.hasEdge(n[0],n[1])&&(s=!0);if(h&&(e(o,r(p),E),yield l("line12",a),!h))return[];if(!s&&(u.push(n),h&&(e(o,r(p),E),yield l("line13",a),!h)))return[]}}for(let i of t){if(h&&(e(o,r(p),E),yield l("line14",a),!h))return[];const t=s(p,i);if(t>-1?p.splice(t,1):console.log("Unable to remove triangle from array!"),h&&(e(o,r(p),E),yield l("line15",a),!h))return[]}for(let t of u){if(h&&(e(o,r(p),E),yield l("line16",a),!h))return[];if(h&&(e(o,r(p),E),yield l("line17",a),!h))return[];if(p.push(new n(t[0],t[1],i)),h&&(e(o,r(p),E),yield l("line18",a),!h))return[]}}let x=[],S=0;for(;S<p.length;){let t=p[S];if(h&&(e(o,r(p),E),yield l("line19",a),!h))return[];if(h&&(e(o,r(p),E),yield l("line20",a),!h))return[];if(t.hasCommmonVertex(v)){const i=s(p,t);if(i>-1?p.splice(i,1):console.log("Unable to remove triangle from array!"),h&&(e(o,r(p),E),yield l("line21",a),!h))return[]}else{for(let e of t.getEdges())x.push(e[0].x,e[0].y,e[1].x,e[1].y);S++}}if(h&&(e(o,r(p),E),yield l("line22",a),!h))return[];e(o,x,u)}))}function u(t,e){t.style.display="block",e.style.display="none"}!function(){const i=document.querySelector("canvas"),n=i.getContext("webgl",{premultipliedAlpha:!1});let s=[],r=[];e(n,s,r);const l=document.getElementById("triangulate"),h=document.getElementById("step"),a=document.getElementById("next"),p=document.getElementById("clear");let c={isStepping:!1},f=new Event("cancelStep");i.onmousedown=function(t){c.isStepping=!1,document.dispatchEvent(f),console.log("offsetX:"+t.offsetX),console.log("offsetY:"+t.offsetY),i.width=i.clientWidth,i.height=i.clientHeight;let l=(-i.width/2+t.offsetX)/(i.width/2),o=(i.height/2-t.offsetY)/(i.height/2);console.log("X: "+l),console.log("Y: "+o),r=r.concat([l,o]),e(n,s,r)},l.addEventListener("click",(function(){c.isStepping=!1,document.dispatchEvent(f),o(n,r,!1,a),u(h,a)})),h.addEventListener("click",(function(){return t(this,void 0,void 0,(function*(){var t;c.isStepping=!0,t=a,h.style.display="none",t.style.display="block",yield o(n,r,!0,a),u(h,a)}))})),p.addEventListener("click",(function(){c.isStepping=!1,document.dispatchEvent(f),s=[],r=[],e(n,s,r),u(h,a)}))}()})();