(()=>{"use strict";var t=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{u(n.next(t))}catch(t){r(t)}}function l(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,l)}u((n=n.apply(t,e||[])).next())}))};function e(t,e,i,n=null,s=0){let r=function(t,e){const i=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(i," attribute vec4 aVertexPosition;\n\nvoid main() {\n  gl_Position = aVertexPosition;\n}"),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}(t),o=function(t,e){const i=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(i,"precision mediump float;\nuniform vec4 vColor;\nuniform int point;\n\nvoid main() {\n\n  gl_FragColor = vColor;\n}\n\n"),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}(t),l=function(t,e,i){let n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;console.log(t.getProgramInfoLog(n)),t.deleteProgram(n)}(t,r,o),u=t.getAttribLocation(l,"aVertexPosition"),a=t.getUniformLocation(l,"vColor"),h=t.getUniformLocation(l,"point"),p=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,p),i=function(t,e,i){let n=[];for(let e=0;e<t.length;e+=2){let s=2*Math.PI/12;for(let r=0;r<=2*Math.PI;r+=s)n=n.concat([t[e],t[e+1],Math.sin(r)*i+t[e],Math.cos(r)*i+t[e+1],Math.sin(r+s)*i+t[e],Math.cos(r+s)*i+t[e+1]])}return n}(i,0,.02);let c=e.concat(i),f=[];if(null!=n){let t=64;s>64&&(t=s*Math.PI/8);let e=2*Math.PI/t;for(let t=0;t<=2*Math.PI;t+=e)f.push(Math.sin(t)*s+n.x,Math.cos(t)*s+n.y,Math.sin(t+e)*s+n.x,Math.cos(t+e)*s+n.y);c=c.concat(f)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(c),t.STATIC_DRAW),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(.094,.094,.145,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(l),t.enableVertexAttribArray(u),t.bindBuffer(t.ARRAY_BUFFER,p);let d=t.FLOAT,g=0;t.vertexAttribPointer(u,2,d,!1,0,g),t.uniform4f(a,.537,.706,.98,1),t.uniform1i(h,1);let m=t.LINES;g=0;let y=e.length/2;console.log(y),t.drawArrays(m,g,y),t.uniform4f(a,.651,.89,.631,1),t.uniform1i(h,1),m=t.LINES,g=e.length/2+i.length/2,y=f.length/2,console.log(y),t.drawArrays(m,g,y),t.uniform4f(a,.953,.545,.659,1),t.uniform1i(h,1),m=t.TRIANGLES,g=e.length/2,y=i.length/2,t.drawArrays(m,g,y)}class i{constructor(t,e,i){this.x=t,this.y=e,this.z=i}cmult(t){return new i(this.x*t,this.y*t,this.z*t)}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return this.add(t.cmult(-1))}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}mag(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}cross(t){return new i(this.y*t.z-this.z*t.y,this.x*t.z-this.z*t.x,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}pair(){return[this.x,this.y]}}class n{constructor(t,e,i){this.p1=t,this.p2=e,this.p3=i}equals(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)&&this.p3.equals(t.p3)||this.p1.equals(t.p1)&&this.p2.equals(t.p3)&&this.p3.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)&&this.p3.equals(t.p3)||this.p1.equals(t.p2)&&this.p2.equals(t.p3)&&this.p3.equals(t.p1)||this.p1.equals(t.p3)&&this.p2.equals(t.p1)&&this.p3.equals(t.p2)||this.p1.equals(t.p3)&&this.p2.equals(t.p2)&&this.p3.equals(t.p1)}hasCommmonVertex(t){return this.p1.equals(t.p1)||this.p2.equals(t.p1)||this.p3.equals(t.p1)||this.p1.equals(t.p2)||this.p2.equals(t.p2)||this.p3.equals(t.p2)||this.p1.equals(t.p3)||this.p2.equals(t.p3)||this.p3.equals(t.p3)}getEdges(){return[[this.p1,this.p2],[this.p2,this.p3],[this.p3,this.p1]]}getCircumradius(){return this.p1.sub(this.p2).mag()*this.p2.sub(this.p3).mag()*this.p3.sub(this.p1).mag()/(2*this.p1.sub(this.p2).cross(this.p2.sub(this.p3)).mag())}getCircumcenter(){let t=2*Math.pow(this.p1.sub(this.p2).cross(this.p2.sub(this.p3)).mag(),2),e=Math.pow(this.p2.sub(this.p3).mag(),2)*this.p1.sub(this.p3).dot(this.p1.sub(this.p2))/t,i=Math.pow(this.p1.sub(this.p3).mag(),2)*this.p2.sub(this.p3).dot(this.p2.sub(this.p1))/t,n=Math.pow(this.p1.sub(this.p2).mag(),2)*this.p3.sub(this.p1).dot(this.p3.sub(this.p2))/t;return this.p1.cmult(e).add(this.p2.cmult(i)).add(this.p3.cmult(n))}inCircumscribe(t){return this.getCircumcenter().sub(t).mag()<this.getCircumradius()}hasEdge(t,e){return(this.p1.equals(t)||this.p2.equals(t)||this.p3.equals(t))&&(this.p1.equals(e)||this.p2.equals(e)||this.p3.equals(e))&&!t.equals(e)}}function s(t,e){for(let i=0;i<t.length;i++)if(t[i].equals(e))return i;return-1}function r(t){let e=[];for(let i of t)for(let t of i.getEdges())e.push(t[0].x,t[0].y,t[1].x,t[1].y);return e}function o(e,i){return t(this,void 0,void 0,(function*(){let n=document.getElementById(e);n.style.outline="solid",n.style.outlineWidth="4px",n.style.outlineColor="#96CDFB",yield function(e){return t(this,void 0,void 0,(function*(){let t;e.addEventListener("click",(function(){t(0)})),document.addEventListener("cancelStep",(function(){t(0)}));let i=new Promise((e=>{t=e}));yield i}))}(i),n.style.outline="2px solid transparent",n.style.outlineOffset="2px"}))}function l(l,u,a=!1,h=new HTMLElement){return t(this,void 0,void 0,(function*(){document.addEventListener("cancelStep",(function(){a=!1}));let t=[],p=[];if(a&&(e(l,[],u),yield o("line02",h),!a))return[];if(u.length<2)return p;let c=u[0],f=c,d=u[1],g=d;for(let e=0;e<u.length;e+=2)u[e]<c&&(c=u[e]),u[e]>f&&(f=u[e]),u[e+1]<d&&(d=u[e+1]),u[e+1]>g&&(g=u[e+1]),t.push(new i(u[e],u[e+1],0));let m=new i(c-1e6,d-1e6,0),y=new i(f+1e6,d-1e6,0),q=new i(Math.floor((c+f)/2),g+1e6,0),v=new n(m,y,q);if(p.push(v),a&&(e(l,r(p),u),yield o("line03",h),!a))return[];let E=[];for(let i of t){if(E.push(i.x,i.y),a&&(e(l,r(p),E),yield o("line04",h),!a))return[];let t=[];if(a&&(e(l,r(p),E),yield o("line05",h),!a))return[];for(let n of p){if(a&&(e(l,r(p),E),yield o("line06",h),!a))return[];if(a&&(e(l,r(p),E,n.getCircumcenter(),n.getCircumradius()),yield o("line07",h),!a))return[];if(n.inCircumscribe(i)&&(t.push(n),a&&(e(l,r(p),E),yield o("line08",h),!a)))return[]}let u=[];if(a&&(e(l,r(p),E),yield o("line09",h),!a))return[];for(let i of t){if(a&&(e(l,r(p),E),yield o("line10",h),!a))return[];for(let n of i.getEdges()){if(a&&(e(l,r(p),E),yield o("line11",h),!a))return[];let s=!1;for(let e of t)!i.equals(e)&&e.hasEdge(n[0],n[1])&&(s=!0);if(a&&(e(l,r(p),E),yield o("line12",h),!a))return[];if(!s&&(u.push(n),a&&(e(l,r(p),E),yield o("line13",h),!a)))return[]}}for(let i of t){if(a&&(e(l,r(p),E),yield o("line14",h),!a))return[];const t=s(p,i);if(t>-1?p.splice(t,1):console.log("Unable to remove triangle from array!"),a&&(e(l,r(p),E),yield o("line15",h),!a))return[]}for(let t of u){if(a&&(e(l,r(p),E),yield o("line16",h),!a))return[];if(a&&(e(l,r(p),E),yield o("line17",h),!a))return[];if(p.push(new n(t[0],t[1],i)),a&&(e(l,r(p),E),yield o("line18",h),!a))return[]}}let x=[],S=0;for(;S<p.length;){let t=p[S];if(a&&(e(l,r(p),E),yield o("line19",h),!a))return[];if(a&&(e(l,r(p),E),yield o("line20",h),!a))return[];if(t.hasCommmonVertex(v)){const i=s(p,t);if(i>-1?p.splice(i,1):console.log("Unable to remove triangle from array!"),a&&(e(l,r(p),E),yield o("line21",h),!a))return[]}else{for(let e of t.getEdges())x.push(e[0].x,e[0].y,e[1].x,e[1].y);S++}}if(a&&(e(l,r(p),E),yield o("line22",h),!a))return[];e(l,x,u)}))}function u(t,e){t.style.display="block",e.style.display="none"}!function(){const i=document.querySelector("canvas"),n=i.getContext("webgl");let s=[],r=[];e(n,s,r);const o=document.getElementById("triangulate"),a=document.getElementById("step"),h=document.getElementById("next"),p=document.getElementById("clear");let c={isStepping:!1},f=new Event("cancelStep");i.onmousedown=function(t){c.isStepping=!1,document.dispatchEvent(f),console.log("offsetX:"+t.offsetX),console.log("offsetY:"+t.offsetY);let o=(-i.width/2+t.offsetX)/(i.width/2),l=(i.height/2-t.offsetY)/(i.height/2);console.log("X: "+o),console.log("Y: "+l),r=r.concat([o,l]),e(n,s,r)},o.addEventListener("click",(function(){c.isStepping=!1,document.dispatchEvent(f),l(n,r,!1,h),u(a,h)})),a.addEventListener("click",(function(){return t(this,void 0,void 0,(function*(){var t;c.isStepping=!0,t=h,a.style.display="none",t.style.display="block",yield l(n,r,!0,h),u(a,h)}))})),p.addEventListener("click",(function(){c.isStepping=!1,document.dispatchEvent(f),s=[],r=[],e(n,s,r),u(a,h)}))}()})();