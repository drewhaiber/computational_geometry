(()=>{"use strict";var t=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{u(n.next(t))}catch(t){r(t)}}function l(t){try{u(n.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,l)}u((n=n.apply(t,e||[])).next())}))};function e(t,e,i){let n=function(t,e){const i=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(i," attribute vec4 aVertexPosition;\n\nvoid main() {\n  gl_Position = aVertexPosition;\n}"),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}(t),s=function(t,e){const i=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(i,"precision mediump float;\nuniform vec4 vColor;\nuniform int point;\n\nvoid main() {\n\n  gl_FragColor = vColor;\n}\n\n"),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS))return i;console.log(t.getShaderInfoLog(i)),t.deleteShader(i)}(t),r=function(t,e,i){let n=t.createProgram();if(t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;console.log(t.getProgramInfoLog(n)),t.deleteProgram(n)}(t,n,s),o=t.getAttribLocation(r,"aVertexPosition"),l=t.getUniformLocation(r,"vColor"),u=t.getUniformLocation(r,"point"),a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),i=function(t,e,i){let n=[];for(let e=0;e<t.length;e+=2){let s=2*Math.PI/12;for(let r=0;r<=2*Math.PI;r+=s)n=n.concat([t[e],t[e+1],Math.sin(r)*i+t[e],Math.cos(r)*i+t[e+1],Math.sin(r+s)*i+t[e],Math.cos(r+s)*i+t[e+1]])}return n}(i,0,.02);let h=e.concat(i);t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clearColor(.094,.094,.145,1),t.clear(t.COLOR_BUFFER_BIT),t.useProgram(r),t.enableVertexAttribArray(o),t.bindBuffer(t.ARRAY_BUFFER,a);let p=t.FLOAT,c=0;t.vertexAttribPointer(o,2,p,!1,0,c),t.uniform4f(l,.537,.706,.98,1),t.uniform1i(u,1);let d=t.LINES;c=0;let f=e.length/2;console.log(f),t.drawArrays(d,c,f),t.uniform4f(l,.953,.545,.659,1),t.uniform1i(u,1),d=t.TRIANGLES,c=e.length/2,f=i.length/2,t.drawArrays(d,c,f)}class i{constructor(t,e,i){this.x=t,this.y=e,this.z=i}cmult(t){return new i(this.x*t,this.y*t,this.z*t)}add(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return this.add(t.cmult(-1))}equals(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}mag(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}cross(t){return new i(this.y*t.z-this.z*t.y,this.x*t.z-this.z*t.x,this.x*t.y-this.y*t.x)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}pair(){return[this.x,this.y]}}class n{constructor(t,e,i){this.p1=t,this.p2=e,this.p3=i}equals(t){return this.p1.equals(t.p1)&&this.p2.equals(t.p2)&&this.p3.equals(t.p3)||this.p1.equals(t.p1)&&this.p2.equals(t.p3)&&this.p3.equals(t.p2)||this.p1.equals(t.p2)&&this.p2.equals(t.p1)&&this.p3.equals(t.p3)||this.p1.equals(t.p2)&&this.p2.equals(t.p3)&&this.p3.equals(t.p1)||this.p1.equals(t.p3)&&this.p2.equals(t.p1)&&this.p3.equals(t.p2)||this.p1.equals(t.p3)&&this.p2.equals(t.p2)&&this.p3.equals(t.p1)}hasCommmonVertex(t){return this.p1.equals(t.p1)||this.p2.equals(t.p1)||this.p3.equals(t.p1)||this.p1.equals(t.p2)||this.p2.equals(t.p2)||this.p3.equals(t.p2)||this.p1.equals(t.p3)||this.p2.equals(t.p3)||this.p3.equals(t.p3)}getEdges(){return[[this.p1,this.p2],[this.p2,this.p3],[this.p3,this.p1]]}getCircumradius(){return this.p1.sub(this.p2).mag()*this.p2.sub(this.p3).mag()*this.p3.sub(this.p1).mag()/(2*this.p1.sub(this.p2).cross(this.p2.sub(this.p3)).mag())}getCircumcenter(){let t=2*Math.pow(this.p1.sub(this.p2).cross(this.p2.sub(this.p3)).mag(),2),e=Math.pow(this.p2.sub(this.p3).mag(),2)*this.p1.sub(this.p3).dot(this.p1.sub(this.p2))/t,i=Math.pow(this.p1.sub(this.p3).mag(),2)*this.p2.sub(this.p3).dot(this.p2.sub(this.p1))/t,n=Math.pow(this.p1.sub(this.p2).mag(),2)*this.p3.sub(this.p1).dot(this.p3.sub(this.p2))/t;return this.p1.cmult(e).add(this.p2.cmult(i)).add(this.p3.cmult(n))}inCircumscribe(t){return this.getCircumcenter().sub(t).mag()<this.getCircumradius()}hasEdge(t,e){return(this.p1.equals(t)||this.p2.equals(t)||this.p3.equals(t))&&(this.p1.equals(e)||this.p2.equals(e)||this.p3.equals(e))&&!t.equals(e)}}function s(t,e){for(let i=0;i<t.length;i++)if(t[i].equals(e))return i;return-1}function r(e,i){return t(this,void 0,void 0,(function*(){let n=document.getElementById(e);n.style.outline="solid",n.style.outlineWidth="4px",n.style.outlineColor="#96CDFB",yield function(e){return t(this,void 0,void 0,(function*(){let t;e.addEventListener("click",(function(){t(0)})),document.addEventListener("cancelStep",(function(){t(0)}));let i=new Promise((e=>{t=e}));yield i}))}(i),n.style.outline="2px solid transparent",n.style.outlineOffset="2px"}))}function o(o,l,u=!1,a=new HTMLElement){return t(this,void 0,void 0,(function*(){document.addEventListener("cancelStep",(function(){u=!1}));let t=[],h=[];if(u&&(e(o,[],l),yield r("line02",a),!u))return[];if(l.length<2)return h;let p=l[0],c=p,d=l[1],f=d;for(let e=0;e<l.length;e+=2)l[e]<p&&(p=l[e]),l[e]>c&&(c=l[e]),l[e+1]<d&&(d=l[e+1]),l[e+1]>f&&(f=l[e+1]),t.push(new i(l[e],l[e+1],0));let g=new i(p-1e6,d-1e6,0),m=new i(c+1e6,d-1e6,0),y=new i(Math.floor((p+c)/2),f+1e6,0),q=new n(g,m,y);if(h.push(q),u&&(e(o,[],l),yield r("line03",a),!u))return[];for(let i of t){if(u&&(e(o,[],l),yield r("line04",a),!u))return[];let t=[];if(u&&(e(o,[],l),yield r("line05",a),!u))return[];for(let n of h){if(u&&(e(o,[],l),yield r("line06",a),!u))return[];if(u&&(e(o,[],l),yield r("line07",a),!u))return[];if(n.inCircumscribe(i)&&(t.push(n),u&&(e(o,[],l),yield r("line08",a),!u)))return[]}let p=[];if(u&&(e(o,[],l),yield r("line09",a),!u))return[];for(let i of t){if(u&&(e(o,[],l),yield r("line10",a),!u))return[];for(let n of i.getEdges()){if(u&&(e(o,[],l),yield r("line11",a),!u))return[];let s=!1;for(let e of t)!i.equals(e)&&e.hasEdge(n[0],n[1])&&(s=!0);if(u&&(e(o,[],l),yield r("line12",a),!u))return[];if(!s&&(p.push(n),u&&(e(o,[],l),yield r("line13",a),!u)))return[]}}for(let i of t){if(u&&(e(o,[],l),yield r("line14",a),!u))return[];const t=s(h,i);if(t>-1?h.splice(t,1):console.log("Unable to remove triangle from array!"),u&&(e(o,[],l),yield r("line15",a),!u))return[]}for(let t of p){if(u&&(e(o,[],l),yield r("line16",a),!u))return[];if(u&&(e(o,[],l),yield r("line17",a),!u))return[];if(h.push(new n(t[0],t[1],i)),u&&(e(o,[],l),yield r("line18",a),!u))return[]}}let v=[],E=0;for(;E<h.length;){let t=h[E];if(u&&(e(o,[],l),yield r("line19",a),!u))return[];if(u&&(e(o,[],l),yield r("line20",a),!u))return[];if(t.hasCommmonVertex(q)){const i=s(h,t);if(i>-1?h.splice(i,1):console.log("Unable to remove triangle from array!"),u&&(e(o,[],l),yield r("line21",a),!u))return[]}else{for(let e of t.getEdges())v.push(e[0].x,e[0].y,e[1].x,e[1].y);E++}}if(u&&(e(o,[],l),yield r("line22",a),!u))return[];e(o,v,l)}))}function l(t,e){t.style.display="block",e.style.display="none"}!function(){const i=document.querySelector("canvas"),n=i.getContext("webgl");let s=[],r=[];e(n,s,r);const u=document.getElementById("triangulate"),a=document.getElementById("step"),h=document.getElementById("next"),p=document.getElementById("clear");let c={isStepping:!1},d=new Event("cancelStep");i.onmousedown=function(t){c.isStepping=!1,document.dispatchEvent(d),console.log("offsetX:"+t.offsetX),console.log("offsetY:"+t.offsetY);let o=(-i.width/2+t.offsetX)/(i.width/2),l=(i.height/2-t.offsetY)/(i.height/2);console.log("X: "+o),console.log("Y: "+l),r=r.concat([o,l]),e(n,s,r)},u.addEventListener("click",(function(){c.isStepping=!1,document.dispatchEvent(d),o(n,r,!1,h),l(a,h)})),a.addEventListener("click",(function(){return t(this,void 0,void 0,(function*(){var t;c.isStepping=!0,t=h,a.style.display="none",t.style.display="block",yield o(n,r,!0,h),l(a,h)}))})),p.addEventListener("click",(function(){c.isStepping=!1,document.dispatchEvent(d),s=[],r=[],e(n,s,r),l(a,h)}))}()})();